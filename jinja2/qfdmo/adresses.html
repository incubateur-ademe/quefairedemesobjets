{% extends 'layout/base.html' %}

{% block content %}

    <turbo-frame id="turboForm">
        <!-- Controleur général de gestion de la navigation et du formulaire -->


        <form data-controller="search-solution-form" id='search_form'
            data-search-solution-form-target="searchForm"
            data-search-solution-form-is-iframe-value="{{ is_embedded(request) }}"
            data-turbo-frame="addressesPanel"
            class="fr-container
            qfdmo-min-h-[700px] qfdmo-max-h-[800px]{%if is_embedded(request) %} qfdmo-h-screen{% else %} qfdmo-h-svh{% endif %}
            qfdmo-flex qfdmo-flex-col qfdmo-flex-auto
            qfdmo-relative"
            data-action="
            map:displayDetails->search-solution-form#displayDetails
            map:updateBbox->search-solution-form#updateBboxInput
            map:setSrcDetailsAddress->search-solution-form#setSrcDetailsAddress
            ss-cat-object-autocomplete:optionSelected->search-solution-form#checkSsCatObjetErrorForm
            address-autocomplete:optionSelected->search-solution-form#checkAdresseErrorForm
            address-autocomplete:formSubmit->search-solution-form#advancedSubmit
            ss-cat-object-autocomplete:formSubmit->search-solution-form#advancedSubmit
            "
            >
            {% include "qfdmo/partials/featureflip_inputs.html" %}
            {% if is_carte(request) %}
                <div class="qfdmo-flex qfdmo-flex-row md:qfdmo-items-center">
                    <div class="qfdmo-items-center qfdmo-hidden md:qfdmo-flex qfdmo-flex-row">
                        {% include 'layout/_partials/header_logos.html' %}
                    </div>

                    <!-- Recherche adresse -->
                    <div class="fr-my-1w qfdmo-flex-grow qfdmo-flex qfdmo-flex-col md:qfdmo-mr-3w">
                        {% include 'qfdmo/_addresses_partials/adresse_input_form.html' %}

                        <div class="fr-my-1w qfdmo-float-right">
                            <button
                                class="fr-btn fr-btn--secondary fr-ml-1w fr-btn--icon-left fr-icon-eye-line qfdmo-float-right"
                                type="button"
                                data-action="click -> search-solution-form#toggleLegend"
                                >
                                Légende
                            </button>
                            <button
                                class="fr-btn fr-btn--secondary fr-ml-1w fr-btn--icon-left fr-icon-equalizer-line qfdmo-float-right"
                                type="button"
                                data-action="click -> search-solution-form#toggleAdvancedFiltersWithSubmitButton"
                                >
                                Filtres
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Panel Result -->
                {% include 'qfdmo/_addresses_partials/carte_result.html' %}
                <!-- Panel «Filtres» -->
                {% include 'qfdmo/_addresses_partials/filters/carte_filters.html' %}
                <!-- Panel «Legend» -->
                {% include 'qfdmo/_addresses_partials/filters/carte_legend.html' %}

            {% else %}
                <!-- Panel «Filtres avancés» -->
                {% include 'qfdmo/_addresses_partials/filters/iframe_advanced_filters.html' %}
                <!-- Panel «Modifier ma recherche» -->
                {% include 'qfdmo/_addresses_partials/iframe_back_to_form.html' %}
                <!-- Panel «Formulaire de recherche» -->
                {% include 'qfdmo/_addresses_partials/iframe_form.html' %}
                <!-- Panel «Résultats de la recherche» -->
                {% include 'qfdmo/_addresses_partials/iframe_result.html' %}
                <!-- Liens de pieds de page pour iframe -->
                {% include 'qfdmo/_addresses_partials/iframe_footer_links.html' %}
            {% endif %}

        </form>
    </turbo-frame>

    {% include 'qfdmo/reparacteur_modale.html' %}
{% endblock %}
