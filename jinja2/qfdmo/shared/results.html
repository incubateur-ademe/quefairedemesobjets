{#
We need to set a size on the map to help Leaflet size its content.
We do not want the map to be bigger than the height of its container

The values of 120px and 150px are determined empirically.
They need to match the css variables used for .grid-map selector in qfdmo.css
#}

{% with address_ok=(form.initial.adresse or form.initial.bounding_box) %}
<div
    class="
    qf-relative
    qf-flex-grow
    qf-shadow
    {% if is_digital %}
    max-md:qf-overflow-scroll
    {% endif %}
    "
    {% if not is_digital %}
    data-controller="map"
    data-map-location-value="{{ location }}"
    {% endif %}
>
    {% if is_digital %}
        {% include "qfdmo/carte/_digital_results.html" %}
    {% else %}
        {# Near by addresses#}
        {% include "qfdmo/carte/_search_in_zone.html" %}
        <div
            id="map"
            class="qf-inset-0 qf-h-full qf-relative qf-z-0"
            data-action="map:captureInteraction->analytics#captureInteractionWithMap"
        >
            {% if is_carte %}
                <a class="qf-flex lg:qf-hidden
                            qf-bg-white
                            fr-mb-1w fr-btn fr-btn--icon-left fr-icon-epingle-plus fr-btn--tertiary qf-whitespace-nowrap qf-w-auto qf-justify-center
                            qf-absolute qf-left-2w qf-right-2w qf-bottom-3w qf-z-30"
                    href="{{ url('qfdmo:address-suggestion-form') }}"
                    target="_blank"
                    rel="noreferrer"
                    aria-label="Proposer une adresse - Nouvelle fenÃªtre"
                >
                    Proposer une adresse
                </a>
            {% endif %}

            {% for acteur in acteurs %}
                <script type="application/json" data-map-target="acteur">
                    {{ acteur.json_acteur_for_display(direction=form.initial.direction, action_list=form.initial.action_list, carte=carte) | safe }}
                </script>
            {% endfor %}
        </div>

        {% if address_ok %}
            {% if is_carte %}
                {% include "qfdmo/carte/panels/legend.html" %}
            {% endif %}

            {% if not acteurs %}
                {% include "qfdmo/shared/disclaimers/no_local_solution.html" %}
            {% endif %}
        {% else %}
            {% include "qfdmo/shared/disclaimers/adresse_missing.html" %}
        {% endif %}
    {% endif %}

    {% include "qfdmo/shared/disclaimers/loading_solutions.html" %}
</div>
{% endwith %}
