/*
Schema generated by scripts/db_schema_create_from_csv.py
 - Script on ID-like fields (e.g. siren, nic etc...)
 - Loose on other fields to avoid pipeline failures for variable data
 - VARCHAR for the same reason we don't control the data
 - {{table_name}} so that no one can run this by mistake AND
    to facilitate table name replacement in Python
*/

CREATE TABLE {{table_name}} (
  "siren" VARCHAR(9), -- 游리 on reste scrict
  "nic" VARCHAR(5), -- 游리 on reste scrict
  "siret" VARCHAR(14), -- 游리 on reste scrict
  "statutDiffusionEtablissement" VARCHAR(1), -- 游리 on reste scrict
  "dateCreationEtablissement" VARCHAR(10), -- 游리 on reste scrict
  "trancheEffectifsEtablissement" VARCHAR(2), -- 2 -> 3
  "anneeEffectifsEtablissement" VARCHAR(4), -- 游리 on reste scrict
  "activitePrincipaleRegistreMetiersEtablissement" VARCHAR(6), -- 6 -> 10
  "dateDernierTraitementEtablissement" VARCHAR(30), -- 19 -> 30
  "etablissementSiege" VARCHAR(5), -- 游리 on reste scrict
  "nombrePeriodesEtablissement" VARCHAR(3), -- 2 -> 3
  "complementAdresseEtablissement" VARCHAR(95), -- 95 -> 125
  "numeroVoieEtablissement" VARCHAR(9), -- semble suffisant
  "indiceRepetitionEtablissement" VARCHAR(10), -- 4 -> 10
  "dernierNumeroVoieEtablissement" VARCHAR(5), -- 5->9 pour etre ISO avec numeroVoie
  "indiceRepetitionDernierNumeroVoieEtablissement" VARCHAR(10), -- 4 -> 10
  "typeVoieEtablissement" VARCHAR(50), -- 27 -> 50
  "libelleVoieEtablissement" VARCHAR(150), -- 100 -> 150
  "codePostalEtablissement" VARCHAR(20), -- 游댮 9 -> 20 (entreprises 칠trang칟res)
  "libelleCommuneEtablissement" VARCHAR(75), -- 45 -> 75
  "libelleCommuneEtrangerEtablissement" VARCHAR(50), -- 32 -> 50
  "distributionSpecialeEtablissement" VARCHAR(4), -- 游리 on reste scrict
  "codeCommuneEtablissement" VARCHAR(5), -- 游리 on reste scrict
  "codeCedexEtablissement" VARCHAR(4), -- 游리 on reste scrict
  "libelleCedexEtablissement" VARCHAR(4), -- 游리 on reste scrict
  "codePaysEtrangerEtablissement" VARCHAR(5), -- 游리 on reste scrict
  "libellePaysEtrangerEtablissement" VARCHAR(50), -- 38 -> 50
  "identifiantAdresseEtablissement" VARCHAR(13), -- 游리 on reste scrict
  "coordonneeLambertAbscisseEtablissement" VARCHAR(18), -- 游리 on reste scrict
  "coordonneeLambertOrdonneeEtablissement" VARCHAR(18), -- 游리 on reste scrict
  "complementAdresse2Etablissement" VARCHAR(10), -- 4 -> 10
  "numeroVoie2Etablissement" VARCHAR(10), -- 4 -> 10
  "indiceRepetition2Etablissement" VARCHAR(10), -- 4 -> 10
  "typeVoie2Etablissement" VARCHAR(10), -- 4 -> 10
  "libelleVoie2Etablissement" VARCHAR(10), -- 4 -> 10
  "codePostal2Etablissement" VARCHAR(10), -- 4 -> 10
  "libelleCommune2Etablissement" VARCHAR(10), -- None -> 10
  "libelleCommuneEtranger2Etablissement" VARCHAR(10), -- None -> 10
  "distributionSpeciale2Etablissement" VARCHAR(10), -- None -> 10
  "codeCommune2Etablissement" VARCHAR(10), -- None -> 10
  "codeCedex2Etablissement" VARCHAR(4), -- 游리 on reste scrict
  "libelleCedex2Etablissement" VARCHAR(4), -- 游리 on reste scrict
  "codePaysEtranger2Etablissement" VARCHAR(10), -- None -> 10
  "libellePaysEtranger2Etablissement" VARCHAR(10), -- None -> 10
  "dateDebut" VARCHAR(10), -- 游리 on reste scrict
  "etatAdministratifEtablissement" VARCHAR(1), -- 游리 on reste scrict
  "enseigne1Etablissement" VARCHAR(75), -- 50 -> 75
  "enseigne2Etablissement" VARCHAR(75), -- 50 -> 75
  "enseigne3Etablissement" VARCHAR(75), -- 50 -> 75
  "denominationUsuelleEtablissement" VARCHAR(125), -- 100 -> 125
  "activitePrincipaleEtablissement" VARCHAR(6), -- 6 -> 10
  "nomenclatureActivitePrincipaleEtablissement" VARCHAR(7), -- 7 -> 10
  "caractereEmployeurEtablissement" VARCHAR(1) -- 游리 on reste scrict
);

/* Constraints */
/*
Tested on 2025-03-10: we cannot add this constraint
as there are duplicate SIRETS, ex: 00032517500016
*/
ALTER TABLE {{table_name}}
ADD CONSTRAINT pk_{{table_name}} PRIMARY KEY (siret);


/* Indexes */
CREATE INDEX idx_{{table_name}}_siren ON {{table_name}} (siren);
CREATE INDEX idx_{{table_name}}_nic ON {{table_name}} (nic);
CREATE INDEX idx_{{table_name}}_siret ON {{table_name}} (siret);
-- "" needed due to camelCase column names
CREATE INDEX "idx_{{table_name}}_statutDiffusionEtablissement" ON {{table_name}} ("statutDiffusionEtablissement");
CREATE INDEX "idx_{{table_name}}_dateCreationEtablissement" ON {{table_name}} ("dateCreationEtablissement");
CREATE INDEX "idx_{{table_name}}_etatAdministratifEtablissement" ON {{table_name}} ("etatAdministratifEtablissement");