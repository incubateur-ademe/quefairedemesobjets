SELECT
    uuid_generate_v5('6ba7b810-9dad-11d1-80b4-00c04fd430c8'::uuid, COALESCE(ra.id, a.id)) as uuid,
    COALESCE(ra.id, a.id) AS id,
    COALESCE(ra.nom, a.nom) AS nom,
    COALESCE(ra.description, a.description) AS description,
    COALESCE(ra.acteur_type_id, a.acteur_type_id) AS acteur_type_id,
    COALESCE(ra.adresse, a.adresse) AS adresse,
    COALESCE(ra.adresse_complement, a.adresse_complement) AS adresse_complement,
    COALESCE(ra.code_postal, a.code_postal) AS code_postal,
    COALESCE(ra.ville, a.ville) AS ville,
    COALESCE(ra.url, a.url) AS url,
    COALESCE(ra.email, a.email) AS email,
    COALESCE(ra.location, a.location) AS location,
    COALESCE(ra.telephone, a.telephone) AS telephone,
    COALESCE(ra.nom_commercial, a.nom_commercial) AS nom_commercial,
    COALESCE(ra.nom_officiel, a.nom_officiel) AS nom_officiel,
    COALESCE(ra.siren, a.siren) AS siren,
    COALESCE(ra.siret, a.siret) AS siret,
    COALESCE(ra.source_id, a.source_id) AS source_id,
    COALESCE(ra.identifiant_externe, a.identifiant_externe) AS identifiant_externe,
    COALESCE(ra.statut, a.statut) AS statut,
    COALESCE(ra.naf_principal, a.naf_principal) AS naf_principal,
    COALESCE(ra.commentaires, a.commentaires) AS commentaires,
    COALESCE(ra.horaires_osm, a.horaires_osm) AS horaires_osm,
    COALESCE(ra.horaires_description, a.horaires_description) AS horaires_description,
    COALESCE(ra.public_accueilli, a.public_accueilli) AS public_accueilli,
    COALESCE(ra.reprise, a.reprise) AS reprise,
    COALESCE(ra.exclusivite_de_reprisereparation, a.exclusivite_de_reprisereparation) AS exclusivite_de_reprisereparation,
    COALESCE(ra.uniquement_sur_rdv, a.uniquement_sur_rdv) AS uniquement_sur_rdv,
    COALESCE(ra.action_principale_id, a.action_principale_id) AS action_principale_id,
    COALESCE(ra.modifie_le, a.modifie_le) AS modifie_le,
    ra.parent_id AS parent_id,
    COALESCE(a.cree_le, ra.cree_le) AS cree_le,
    -- avec_revision est true si la table revisionacteur existe
    ra.id IS NOT NULL AS revision_existe
FROM {{ ref('base_acteur') }} AS a
FULL JOIN {{ ref('base_revisionacteur') }} AS ra
  ON a.id = ra.id
