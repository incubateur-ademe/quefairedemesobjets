{% extends base_template %}
{% load static %}

{% block content %}
<turbo-frame
    id="{{ map_container_id }}"
    {% if request.user.is_authenticated and DEBUG %}
    data-turbo-action="advance"
    {% endif %}
    data-name="{{ request.resolver_match.url_name }}"
>
    {# Controleur général de gestion de la navigation et du formulaire #}
    <form
        id='{{ map_container_id }}:search_form'
        data-controller="search-solution-form"
        data-search-solution-form-target="searchForm"
        data-search-solution-form-is-iframe-value="{{ is_embedded }}"
        data-action="
        map:updateBbox->search-solution-form#updateBboxInput
        search-solution-form:captureInteraction->analytics#captureInteractionWithMap
        address-autocomplete:formSubmit->search-solution-form#advancedSubmit
        ss-cat-object-autocomplete:formSubmit->search-solution-form#advancedSubmit
        ss-cat-object-autocomplete:optionSelected->search-solution-form#checkSsCatObjetErrorForm"
        class="
        qf-rounded-lg qf-border qf-border-solid qf-border-grey-900
        qf-group
        qf-h-full qf-overflow-hidden
        qf-m-0
        qf-flex qf-flex-col qf-flex-auto
        qf-relative"
        {# TODO: attempt to remove this conditionnal... #}
        {% if request.resolver_match.namespace == "qfdmd" and request.resolver_match.url_name == "carte" %}
        action="carte/"
        {% elif carte_config %}
        action="{{ carte_config.get_absolute_url }}"
        {% endif %}
        data-search-form-visible
        data-search-solution-form-map-container-id-value="{{ map_container_id }}"
    >
        <input type="hidden" name="map_container_id" value="{{ map_container_id }}">
        <section class="map-grid qf-relative">
            {% include 'ui/components/carte/header.html' %}

            {% if mode_liste %}
                {% include "ui/components/carte/mode_liste.html" %}
            {% else %}
                {% include "ui/components/carte/mode_carte.html" %}
            {% endif %}

            {% include "ui/components/carte/acteur_detail.html" %}
        </section>

        {# Panel «Filtres» #}
        {% include 'ui/components/carte/modals/filters.html' %}

        {# Panel À propos #}
        {# TODO: refacto turbo, should be moved outside of form #}
        {% include 'ui/components/carte/modals/a_propos.html' %}
    </form>
</turbo-frame>
{% endblock content %}

{% block modals %}
    {% include "ui/components/carte/reparacteur_modale.html" %}
{% endblock modals %}
