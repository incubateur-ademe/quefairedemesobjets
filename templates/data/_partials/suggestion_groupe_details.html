{% extends "data/_partials/suggestion_groupe.html" %}

{% load share_tags %}

{% block suggestion_details %}

    <input type="hidden" name="fields_values" value='{{ fields_values|tojson }}' data-suggestion-groupe-row-target="fieldsValues">
    <input type="hidden" name="fields_groups" value='{{ fields_groups|tojson }}' data-suggestion-groupe-row-target="fieldsGroups">
    <h3>requested_fields_list</h3>
    {{ requested_fields_list }}
    <h3>fields_values</h3>
    {{ fields_values }}
    <h3>fields_groups</h3>
    {{ fields_groups }}
    <div class="fr-table fr-table--bordered">
        <table>
            <thead>
                <tr>
                    <th class="qf-w-1/4">
                        <div class="qf-truncate"></div>
                    </th>
                    <th class="qf-w-1/4">
                        <div class="qf-truncate">Importé</div>
                    </th>
                    <th class="qf-text-center qf-text-2xl">
                        <div data-action="click->suggestion-groupe-row#updateAllDisplayed" class="qf-cursor-pointer">
                            ➡️
                        </div>
                    </th>
                    <th class="qf-w-1/4">
                        <div class="qf-truncate">Affiché</div>
                        {% if acteur_overridden_by.nombre_enfants %}
                            <div class="qf-truncate">{{ acteur_overridden_by.nombre_enfants }} enfants impactés</div>
                        {% endif %}
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for fields in fields_groups %}
                    <tr>
                        <td>{{ fields|join:", " }}</td>
                        <td>
                            {% for field in fields %}
                                {% with values=fields_values|get_item:field %}
                                    {% display_diff_value_details None values.new_value values.old_value %}
                                {% endwith %}
                                {% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                        <td class="qf-text-center qf-cursor-pointer qf-text-2xl" data-action="click->suggestion-groupe-row#refresh">
                            ➡️
                        </td>
                        <td>
                            {% for field in fields %}
                                {% with values=fields_values|get_item:field %}
                                    {% if values.updated_displayed_value and values.updated_displayed_value != values.displayed_value %}
                                        {% display_diff_value_details None values.updated_displayed_value values.displayed_value %}
                                    {% else %}
                                        {{ values.displayed_value }}
                                    {% endif %}
                                {% endwith %}
                                {% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


{% endblock suggestion_details %}
