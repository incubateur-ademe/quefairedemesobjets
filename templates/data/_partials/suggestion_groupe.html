{% load admin_data_tags %}

<turbo-frame
    id="suggestion_groupe_{{ suggestion_groupe.id }}"
    data-controller="suggestion-groupe-row"
    data-update-suggestion-url="{% url 'data:suggestion_groupe' suggestion_groupe.id %}"
    data-action="map:markerDragged->suggestion-groupe-row#handleMarkerDragged"
    data-suggestion-groupe-row-fields-values-value='{{ fields_values|tojson }}'
    data-suggestion-groupe-row-fields-groups-value='{{ fields_groups|tojson }}'
    >

    <h3>
        {% block suggestion_title %}
            <a href="{% url 'admin:data_suggestiongroupe_change' suggestion_groupe.id %}" rel="noreferrer" data-turbo="false">{{ suggestion_groupe.id }}</a> :
            {% if acteur %}{{ acteur }} - {% endif %}{{ identifiant_unique }}
            {% if acteur %}
                (
                <a href="{% url 'admin:qfdmo_acteur_change' acteur.identifiant_unique|quote %}" target="_blank" rel="noreferrer" data-turbo="false">importé</a>
                {% if revision_acteur %}
                    , <a href="{% url 'admin:qfdmo_revisionacteur_change' revision_acteur.identifiant_unique|quote %}" target="_blank" rel="noreferrer" data-turbo="false"> corrigé</a>
                {% endif %}
                , <a href="{% url 'admin:qfdmo_vueacteur_change' acteur.identifiant_unique|quote %}" target="_blank" rel="noreferrer" data-turbo="false">affiché</a>
                )
            {% endif %}
        {% endblock suggestion_title %}
    </h3>
    <div class="qf-flex qf-flex-col qf-items-left qf-gap-1v">
        <span class="qf-ml-3w qf-text-xs qf-italic">
            {% block suggestion_subtitle %}
                Cohorte :
                <a href="{% url 'admin:data_suggestioncohorte_change' suggestion_groupe.suggestion_cohorte.id %}" rel="noreferrer" data-turbo="false">{{ suggestion_groupe.suggestion_cohorte.id }} - {{ suggestion_groupe.suggestion_cohorte.get_type_action_display }}</a>
            {% endblock suggestion_subtitle %}
        </span>
        <div class="qf-flex qf-flex-row qf-gap-1w">
            <span class="qf-ml-3w qf-text-lg qf-italic">
                {{ suggestion_groupe.get_statut_display }}
            </span>
            <button
                type="button"
                data-action="click->suggestion-groupe-row#updateStatus"
                data-action-value="validate"
                data-status-url="{% url 'data:suggestion_groupe_status' suggestion_groupe.id %}">
                ✅ VALIDER la suggestion
            </button>
            <button
                type="button"
                data-action="click->suggestion-groupe-row#updateStatus"
                data-action-value="reject"
                data-status-url="{% url 'data:suggestion_groupe_status' suggestion_groupe.id %}">
                ❌ REJETER la suggestion
            </button>
            <button
                type="button"
                data-action="click->suggestion-groupe-row#updateStatus"
                data-action-value="to_process"
                data-status-url="{% url 'data:suggestion_groupe_status' suggestion_groupe.id %}">
                ⏳ Renvoyer à valider
            </button>
        </div>
    </div>
    <div class="qf-my-3w">
        {% block suggestion_details %}
        {% endblock suggestion_details %}
    </div>
</turbo-frame>
